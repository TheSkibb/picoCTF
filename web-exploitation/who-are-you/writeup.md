## Who are you?

difficulty: medium plus

---

sol:

when entering the website we are met with a message that only people using the official pico browser are allowed to view the site

from the name of the ctf being "who are you" and the hint linking to the http/1.1 i am wondering if it has something to do with verifying what browser the client is using
maybe modifying the user agent string for the initial request

using this [article](https://www.whatismybrowser.com/guides/how-to-change-your-user-agent/firefox) to change the user agen string to picobrowser, the message changes to 

> I don't trust users visiting from another site.

this hint sound like it has something to do with cross origin requests

looking around in the linked document i found the specification:

> The Referer[sic] request-header field allows the client to specify,
> for the server's benefit, the address (URI) of the resource from
> which the Request-URI was obtained (the "referrer", although the
> header field is misspelled.) The Referer request-header allows a
> server to generate lists of back-links to resources for interest,
> logging, optimized caching, etc. It also allows obsolete or mistyped
> links to be traced for maintenance. The Referer field MUST NOT be
> sent if the Request-URI was obtained from a source that does not have
> its own URI, such as input from the user keyboard.

i now switched to creating a curl script:

first i changed the [user agent with -H](https://stackoverflow.com/questions/28760694/how-to-use-curl-to-get-a-get-request-exactly-same-as-using-chrome)

then i set the [referer with -e](https://catonmat.net/cookbooks/curl/add-referrer)

i now got a different message:

> Sorry, this site only worked in 2018

i am wondering if this may have to modify the system time of my machine

~~~
timedatectl set-ntp 0
~~~
~~~
sudo timedatectl set-time "2018-01-01 23:00:01"
~~~

i set it to be in 2018 with but it did not do any difference.

(set it back with)
~~~
timedatectl set-ntp 0
~~~

now sending the request, there is no difference

instead i realized i could use a date header with -H "Date: 2018"

now we get a new message:

> I don&#39;t trust users who can be tracked

knowing that all the progress this far has been to add different flags i search for flags to disable tracking

after searching for http and tracking i found a deprecated flag calld "DNT"

adding this to my curl script i get a new message:

> This website is only for people from Sweden

now i start searchin for a flag specifying the country of origin for the request

i tried a bunch of different headers i found from searching around

- CountryCode
- Country-Code
- X-Country-Code

a technique i could use is to pretend that i am a proxyserver and use the [x-forwarded-for](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For) header to pretend that i am proxying a request for a swedish client

all i need is a swedish ip

using a combination of sites i found 
a fun observation is that many swedish government sites uses cloudflare, and their servers are therefore not located in sweden

with a valid swedish ip i now got a different message:

> You&#39;re in Sweden but you don&#39;t speak Swedish

now to find out another header, maybe one that specified the requested language

i tried the [accept-language](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language)
to find the language code for swedish i used the [iso639](https://www.loc.gov/standards/iso639-2/php/code_list.php) standard

i now get the message:

> What can I say except, you are welcome and the flag

## Learned

http headers:

- useragent -> what browser is the client using
- referer -> what url did the client come from
- dnt -> do not track (deprecated)
- x-forwarded-for -> ip of who is "actually" sending the request (can be used to spoof country)
- accept-language -> what language does the client want

headers can be set for curl request with -H + some headers can be added with special characters like -A for useragent and -e for referer
